{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "f3d786cc_9bbddcd0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1162439
      },
      "writtenOn": "2021-11-18T12:26:50Z",
      "side": 1,
      "message": "ptal",
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5cb31a7d_4464cb87",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1180419
      },
      "writtenOn": "2021-11-19T13:35:24Z",
      "side": 1,
      "message": "Thanks!",
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d5db82b8_e9e90966",
        "filename": "src/objects/intl-objects.cc",
        "patchSetId": 2
      },
      "lineNbr": 915,
      "author": {
        "id": 1162439
      },
      "writtenOn": "2021-11-18T12:26:50Z",
      "side": 1,
      "message": "Note the templatization is a third fix - since on the main thread we want to access the current value of default_locale, not the one copied and cached at isolate creation.",
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "692001ec_743e7ea0",
        "filename": "src/objects/intl-objects.cc",
        "patchSetId": 2
      },
      "lineNbr": 915,
      "author": {
        "id": 1180419
      },
      "writtenOn": "2021-11-19T13:35:24Z",
      "side": 1,
      "message": "I don\u0027t think this is strictly necessary. My definition of LocalIsolate::DefaultLocale() already forwards to the actual Isolate if it\u0027s the main-thread LocalIsolate, and default_locale_has_been_reset() could do the same.",
      "parentUuid": "d5db82b8_e9e90966",
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "adc4f8c6_c501a1d8",
        "filename": "src/objects/intl-objects.cc",
        "patchSetId": 2
      },
      "lineNbr": 915,
      "author": {
        "id": 1162439
      },
      "writtenOn": "2021-11-22T07:22:17Z",
      "side": 1,
      "message": "Ack. I like the template-on-IsolateT solution since it\u0027s somewhat of a common pattern in V8 (search for \u0027class IsolateT\u0027), and it seems simpler to me than to treat the Isolate as a LocalIsolate. Wdyt about reverting the \u0027is_main_thread\u0027 logic in LocalIsolate?",
      "parentUuid": "692001ec_743e7ea0",
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e037fed0_b1d26113",
        "filename": "src/objects/intl-objects.cc",
        "patchSetId": 2
      },
      "lineNbr": 915,
      "author": {
        "id": 1180419
      },
      "writtenOn": "2021-11-23T15:11:30Z",
      "side": 1,
      "message": "SGTM, but then please add an assert to LocalIsolate that this method is not called from the main thread.",
      "parentUuid": "adc4f8c6_c501a1d8",
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "059fe253_7f326c68",
        "filename": "src/objects/intl-objects.cc",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1180419
      },
      "writtenOn": "2021-11-19T13:35:24Z",
      "side": 1,
      "message": "We actually currently have a subtle bug: If the default locale is reset, the compiler thread won\u0027t know and the base::CallOnce won\u0027t re-evaluate the default locale. This was wrong before already, I just didn\u0027t notice.\nWould it be possible to remove the CallOnce and simplify the logic? Then you could also remove the default_locale_has_been_reset thing. Going through the list shouldn\u0027t be that slow.",
      "range": {
        "startLine": 946,
        "startChar": 4,
        "endLine": 946,
        "endChar": 18
      },
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb312ff2_487444f7",
        "filename": "src/objects/intl-objects.cc",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1162439
      },
      "writtenOn": "2021-11-22T07:22:17Z",
      "side": 1,
      "message": "Which case do you mean? Resetting the locale will DeoptAll and stop any running compiler jobs. In new jobs after that, the locale reset should be picked up correctly, no?",
      "parentUuid": "059fe253_7f326c68",
      "range": {
        "startLine": 946,
        "startChar": 4,
        "endLine": 946,
        "endChar": 18
      },
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7ee8c09d_7e5a3baf",
        "filename": "src/objects/intl-objects.cc",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1180419
      },
      "writtenOn": "2021-11-22T10:39:46Z",
      "side": 1,
      "message": "As discussed offline, this is an issue. How about just removing the CallOnce and default_locale_has_been_reset logic altogether?",
      "parentUuid": "bb312ff2_487444f7",
      "range": {
        "startLine": 946,
        "startChar": 4,
        "endLine": 946,
        "endChar": 18
      },
      "revId": "fa4e437c9724453342c0f3cec6a412521855783b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}