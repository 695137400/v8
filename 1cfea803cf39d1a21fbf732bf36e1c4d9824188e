{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "0512d5c4_56400494",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1472029
      },
      "writtenOn": "2021-05-25T22:38:25Z",
      "side": 1,
      "message": "Tests mjsunit/compiler/call-with-arraylike-or-spread* also need to disable --stress-background-compile.",
      "revId": "1cfea803cf39d1a21fbf732bf36e1c4d9824188e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1c498c3b_438218f4",
        "filename": "test/mjsunit/compiler/call-with-arraylike-or-spread.js",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2021-05-26T07:50:17Z",
      "side": 1,
      "message": "At this point the call feedback in foo has become megamorphic. I think that\u0027s not what your test had in mind, and that\u0027s why you get strange behavior in combination with other flags. Right now I\u0027m puzzled as to why it became megamorphic. Could you please look into that?",
      "revId": "1cfea803cf39d1a21fbf732bf36e1c4d9824188e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0cac9829_7c2f4916",
        "filename": "test/mjsunit/compiler/call-with-arraylike-or-spread.js",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1472029
      },
      "writtenOn": "2021-05-26T19:32:10Z",
      "side": 1,
      "message": "It is in fact megamorphic.\n\nWith:\n  function foo(x, y) {\n    return sum_js3.apply(null, [x,0,y]);\n  }\nThe Feedback Vector for function foo() has a monomorphic slot for the call to sum_js3():\n - slot #5 Call MONOMORPHIC {\n     [5]: [weak] 0x01dc08114d1d \u003cJSFunction sum_js3 (sfi \u003d 000001DC08296C59)\u003e\n     [6]: 6\n  }\n\nWith a hole:\n  function foo(x, y) {\n    return sum_js3.apply(null, [x, ,y]);\n  }\nThe Feedback Vector for function foo() becomes megamorphic:\n - slot #5 Call GENERIC {\n     [5]: 0x01dc08005285 \u003cSymbol: (megamorphic_symbol)\u003e\n     [6]: 13\n  }\n\nThe transition to megamorphic happens in Builtins_CallProperty2Handler. Now I need to understand why.",
      "parentUuid": "1c498c3b_438218f4",
      "revId": "1cfea803cf39d1a21fbf732bf36e1c4d9824188e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "29bd0ede_9473d67f",
        "filename": "test/mjsunit/compiler/call-with-arraylike-or-spread.js",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1472029
      },
      "writtenOn": "2021-05-27T02:16:34Z",
      "side": 1,
      "message": "This seems to be caused by the fact that for HOLEY_DOUBLE_ELEMENTS we add a CheckFloat64Hole that causes a deopt if there is a hole. So what happens is that:\n\n1. We begin compiling method foo.\n\n2. There is a deopt-eager, reason: hole for foo.\n\n3. Later, the interpreter calls: Builtins_CallProperty2Handler -\u003e CollectCallFeedback.\nCollectCallFeedback transitions to megamorphic because feedbackCell is not equal to targetFeedbackCell:\n\n    feedback is initialized,\n    target is JSFunction \"apply\"\n    feedbackValue is JSFunction \"sum_js3\"\n\n    targetFeedbackCell \u003d target.feedback_cell is:\n    DebugPrint: 000001DC08296E45: [FeedbackCell] in OldSpace\n    - map: 0x01dc08002bd5 \u003cMap[12]\u003e\n    - one closure\n    - value: 0x01dc08296f71 \u003cFeedbackVector[2]\u003e\n\n    feedbackCell: \u003d Cast\u003cJSFunction\u003e(feedbackValue).feedback_cell is:\n    DebugPrint: 000001DC0820244D: [FeedbackCell] in OldSpace\n    - map: 0x01dc08002ae5 \u003cMap[12]\u003e\n    - many closures\n    - value: 0x01dc080023b5 \u003cundefined\u003e\n\nIs the mismatch here due to the fact that we transform a call to \u0027apply\u0027 into a call to \u0027sum_js3\u0027?\n\n\nInstead, modifying the code to call\n    sum_js3.apply(null, [x,0,y]);\nwithout holes, CollectCallFeedback immediately goes to TryInitializeAsMonomorphic because \"feedback\" is uninitialized.",
      "parentUuid": "0cac9829_7c2f4916",
      "revId": "1cfea803cf39d1a21fbf732bf36e1c4d9824188e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0f13bf2b_115e49dd",
        "filename": "test/mjsunit/compiler/call-with-arraylike-or-spread.js",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1472029
      },
      "writtenOn": "2021-05-27T02:29:00Z",
      "side": 1,
      "message": "Should we avoid this optimization for HOLEY_DOUBLE_ELEMENTS?",
      "parentUuid": "29bd0ede_9473d67f",
      "revId": "1cfea803cf39d1a21fbf732bf36e1c4d9824188e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}