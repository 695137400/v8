{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "833cc407_bb1a2ff9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1148154
      },
      "writtenOn": "2021-07-12T19:40:32Z",
      "side": 1,
      "message": "Hi Michael, I did some debugging with one of the failed test, and here is what I found.\n\nWith this CL:\nWhen WebMediaPlayerImplTest::~WebMediaPlayerImplTest() is called, the code path goes to IncrementalMarkingJob::Task::RunInternal().\n\nWithout this CL:\nThe code path goes to Sweeper::IncrementalSweeperTask::RunInternal().\n\nWhy does it crash? The IncrementalMarkingJob::Task::RunInternal() calls into Heap::FinalizeIncrementalMarkingIfComplete(), and eventually calls the ChromeClientImpl::RequestBeginMainFrameNotExpected(). Note that in a unit test, we don\u0027t really need to create a \"WebFrameWidgetImpl\" and that\u0027s why it crashed.\n\nDoes that help? Please let me know so that and I am happy to debug further.",
      "revId": "6822edb7074b30f71d8f0753eb4bb6ff47f4dc57",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6c0a7071_e481adcd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1148154
      },
      "writtenOn": "2021-07-12T19:48:53Z",
      "side": 1,
      "message": "Sorry for sending multiple messages, it seems that without this CL, the StartIncrementalMarkingIfAllocationLimitIsReached() function is never called. With this CL, that function is called with \"soft limit reached\". And that seems to be triggered by the code at heap.cc:5275",
      "revId": "6822edb7074b30f71d8f0753eb4bb6ff47f4dc57",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "92e37c58_fdf4ae27",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1131764
      },
      "writtenOn": "2021-07-12T20:19:51Z",
      "side": 1,
      "message": "Hey, thanks for taking a look at this. (Bit late here but I wanted to give you a summary of what I think is happening.)\n\nThe CL changes GC timing in that it may trigger a GC where there previously was no GC. While GC should be supported at any time blink, this change causes hickups as we likely introduce a GC early on in unit tests where we never had one before. In theory, all of this should just work (tm).\n\nNow, as for what you saw:\n- *Mark*: That\u0027s the marking phase of the GC.\n- *Sweep*: That\u0027s the sweeping, or reclamation, phase of the GC that reclaims unreachable objects.\n\nWith the CL, we do one GC more and through reclaiming an object trigger various other actions in a destructor which eventually lead to `RequestBeginMainFrameNotExpected()`.\n\nWhat we would need to figure out is why reclaiming some object results in a call of `RequestBeginMainFrameNotExpected()`. This is why I added dcheng@ to the bug as well as he may have more background there.\n\nUnfortunately, this is pretty far from my main area, so any help here would be appreciated.",
      "parentUuid": "833cc407_bb1a2ff9",
      "revId": "6822edb7074b30f71d8f0753eb4bb6ff47f4dc57",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d67f5d4d_387fa5bc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1001168
      },
      "writtenOn": "2021-07-13T18:35:42Z",
      "side": 1,
      "message": "This isn\u0027t related to bug 838348. It\u0027s because third_party/blink/renderer/platform/media/web_media_player_impl_unittest.cc tries to set up its own test environment, but does so incorrectly. It creates a WebViewImpl and a WebLocalFrameImpl, but it does not attach a WebFrameWidgetImpl to the main frame (which is a local root). This causes the page scheduler call to break, because it expects (reasonably so) that a local main frame always has a frame widget.\n\nLet me try to send a CL.",
      "parentUuid": "92e37c58_fdf4ae27",
      "revId": "6822edb7074b30f71d8f0753eb4bb6ff47f4dc57",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}