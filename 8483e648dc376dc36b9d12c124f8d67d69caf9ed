{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "90077e78_242ae43c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 19
      },
      "lineNbr": 0,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-04T18:43:33Z",
      "side": 1,
      "message": "Renamed the wall_clock field to duration_in_us. I also replaced the TimedScope in the wasm code with an ElapsedTimer, which let me remove the TimedScope(Event* event) constructor.\n\nIs it time to move onto step 2 of the ETW instrumentation?",
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5757b9ca_35625f5d",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 78,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-04T19:02:12Z",
      "side": 1,
      "message": "Sorry, I was too fuzzy about this.\nWe currently cannot change it, it\u0027s already used by chrome, it requires a two step refactoring (let\u0027s postpone this and just add a TODO)\n\nIf we first refactor the WASM code in a separate CL we can use the duration_us in this CL for the newly added Compile events.",
      "range": {
        "startLine": 78,
        "startChar": 10,
        "endLine": 78,
        "endChar": 24
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "949a8965_c5a2f113",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 78,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-04T19:31:31Z",
      "side": 1,
      "message": "Could you point me to where the wasm stuff is being used in chrome so I can have a better idea of what I need to put in the separate CL?",
      "parentUuid": "5757b9ca_35625f5d",
      "range": {
        "startLine": 78,
        "startChar": 10,
        "endLine": 78,
        "endChar": 24
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb5a9303_6fae92bf",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 78,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-05T08:06:02Z",
      "side": 1,
      "message": "CodeSearch is your friend :): https://source.chromium.org/search?q\u003dWasmModuleInstantiated\n\nMainly this here: \nhttps://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/bindings/core/v8/v8_metrics.cc?q\u003dWasmModuleInstantiated",
      "parentUuid": "949a8965_c5a2f113",
      "range": {
        "startLine": 78,
        "startChar": 10,
        "endLine": 78,
        "endChar": 24
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c6394427_62c014f0",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 78,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-05T18:21:46Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "eb5a9303_6fae92bf",
      "range": {
        "startLine": 78,
        "startChar": 10,
        "endLine": 78,
        "endChar": 24
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "afaf2ff8_106a03ae",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 78,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-05T18:21:46Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "eb5a9303_6fae92bf",
      "range": {
        "startLine": 78,
        "startChar": 10,
        "endLine": 78,
        "endChar": 24
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "69f2404e_57d2481d",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 169,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-04T19:02:12Z",
      "side": 1,
      "message": "what do you mean by \"should throw errors\"?\n\nV8 does not support C++ exceptions, and I think the instrumentation errors should not be surfaced directly in V8 execution.\n\nI think the only way is printing to std error.\n\nWhat kind of errors do you think would appear?",
      "range": {
        "startLine": 167,
        "startChar": 0,
        "endLine": 169,
        "endChar": 19
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7fa22323_3f6a1b06",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 169,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-04T19:31:31Z",
      "side": 1,
      "message": "I was imagining something like UNREACHABLE() because we never want a MainThreadEvent to be called into AddThreadSafeEvent.",
      "parentUuid": "69f2404e_57d2481d",
      "range": {
        "startLine": 167,
        "startChar": 0,
        "endLine": 169,
        "endChar": 19
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c2374f50_ff0f720e",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 169,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-10T18:44:11Z",
      "side": 1,
      "message": "bump.",
      "parentUuid": "7fa22323_3f6a1b06",
      "range": {
        "startLine": 167,
        "startChar": 0,
        "endLine": 169,
        "endChar": 19
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0bd7bf7_f09c142f",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 169,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-10T21:51:51Z",
      "side": 1,
      "message": "Sorry, I silently agreed to this :P UNREACHABLE is the way to go.",
      "parentUuid": "c2374f50_ff0f720e",
      "range": {
        "startLine": 167,
        "startChar": 0,
        "endLine": 169,
        "endChar": 19
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "948595b5_c63b92b3",
        "filename": "include/v8-metrics.h",
        "patchSetId": 19
      },
      "lineNbr": 169,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-11T05:48:17Z",
      "side": 1,
      "message": "OK! UNREACHABLE is defined in src/base/logging.h, and uses a bunch of other logging macros. If I include it in include/ I get the following presubmit error:\n\n** Presubmit ERRORS **\nYou added one or more #includes that violate checkdeps rules.\n  include\\v8-metrics.h\n      Illegal include: \"src/base/logging.h\"\n    Because of no rule applying.\n\nNot sure what the best way to proceed would be. Should I copy the implementation in src/base/logging.h into a new file, include/v8-logging.h? But the one in src/ has a bunch of dependencies.",
      "parentUuid": "f0bd7bf7_f09c142f",
      "range": {
        "startLine": 167,
        "startChar": 0,
        "endLine": 169,
        "endChar": 19
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93722392_22c690cb",
        "filename": "src/d8/d8.cc",
        "patchSetId": 19
      },
      "lineNbr": 4182,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-04T19:02:12Z",
      "side": 1,
      "message": "This is something we should initialise on demand only to minimize the performance impact.\n\n #if V8_OS_WIN\n   if (options.platform_instrumentation) {\n     create_params.metrics_recorder \u003d\n      ...\n   }\n #endif\n\n\nSee options.enable_inspector in d8.cc for an example on how to do this.",
      "range": {
        "startLine": 4181,
        "startChar": 0,
        "endLine": 4182,
        "endChar": 55
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e47d94c_47fefe18",
        "filename": "src/d8/d8.cc",
        "patchSetId": 19
      },
      "lineNbr": 4182,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-05T18:21:46Z",
      "side": 1,
      "message": "If possible, I\u0027d really like to have the ETW provider initialized by default. Even after initialization, the provider is not enabled until an external program turns it on (like Windows Performance Recorder). So there should be little performance impact by default.\n\nI\u0027d be happy to run some performance checks to confirm if you\u0027d like. I believe our perf lab runs the same metrics as the Chromium one.",
      "parentUuid": "93722392_22c690cb",
      "range": {
        "startLine": 4181,
        "startChar": 0,
        "endLine": 4182,
        "endChar": 55
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd84fd6b_6c7851e1",
        "filename": "src/d8/d8.cc",
        "patchSetId": 19
      },
      "lineNbr": 4182,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-06T19:58:01Z",
      "side": 1,
      "message": "Started the perf run, will let you know the results.",
      "parentUuid": "8e47d94c_47fefe18",
      "range": {
        "startLine": 4181,
        "startChar": 0,
        "endLine": 4182,
        "endChar": 55
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b4c37dde_8fb319c8",
        "filename": "src/d8/d8.cc",
        "patchSetId": 19
      },
      "lineNbr": 4182,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-09T15:40:31Z",
      "side": 1,
      "message": "Results came back over the weekend, there is actually a significant perf impact for some of the V8 tests, in particular these three:\n  - v8.browsing_desktop-future/browse:news:reddit:2018/Compile-Background:duration (55ms vs 39ms)\n  - v8.browsing_desktop-future/browse:tech:discourse_infinite_scroll:2018/JavaScript:duration (4400ms vs 3800ms)\n  - v8.browsing_desktop-future/browse:tech:discourse_infinite_scroll:2018/Total:duration (13000ms vs 11000ms)\n\nSo I\u0027ll have to look into what\u0027s causing that, because without a controller the ETW provider shouldn\u0027t be doing any work.\n\nIn the mean time, I\u0027ll put everything behind a compile-time flag like you suggested.",
      "parentUuid": "fd84fd6b_6c7851e1",
      "range": {
        "startLine": 4181,
        "startChar": 0,
        "endLine": 4182,
        "endChar": 55
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fa504086_c45f2648",
        "filename": "src/d8/d8.cc",
        "patchSetId": 19
      },
      "lineNbr": 4182,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-09T15:50:04Z",
      "side": 1,
      "message": "yeah, these tests have quite some variance too.\n\nWhat\u0027s speaking against lazily initialising the recorder?\nThis is d8, so that\u0027s still independent of any potential embedder.",
      "parentUuid": "b4c37dde_8fb319c8",
      "range": {
        "startLine": 4181,
        "startChar": 0,
        "endLine": 4182,
        "endChar": 55
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aa7af166_32894e05",
        "filename": "src/d8/d8.cc",
        "patchSetId": 19
      },
      "lineNbr": 4182,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-09T16:01:06Z",
      "side": 1,
      "message": "Nothing, I guess. Lazy init sounds good.",
      "parentUuid": "fa504086_c45f2648",
      "range": {
        "startLine": 4181,
        "startChar": 0,
        "endLine": 4182,
        "endChar": 55
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04d4351f_c07f58d1",
        "filename": "src/d8/d8.cc",
        "patchSetId": 19
      },
      "lineNbr": 4182,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-10T18:44:11Z",
      "side": 1,
      "message": "I\u0027m a bit confused. Do we want to hide this change behind both a build-time flag (v8_enable_system_instrumentation) and a command-line one?",
      "parentUuid": "aa7af166_32894e05",
      "range": {
        "startLine": 4181,
        "startChar": 0,
        "endLine": 4182,
        "endChar": 55
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c50a3d9c_c8a23301",
        "filename": "src/d8/d8.cc",
        "patchSetId": 19
      },
      "lineNbr": 4182,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-10T21:51:51Z",
      "side": 1,
      "message": "I thought: \n- Build time for embedders and until we\u0027re sure it\u0027s stable and doesn\u0027t have any negative impact.\n- run-time command-line flag for testing with d8\n\nI\u0027m not super strict about this at this point, probably it\u0027s good enough to just have the latter",
      "parentUuid": "04d4351f_c07f58d1",
      "range": {
        "startLine": 4181,
        "startChar": 0,
        "endLine": 4182,
        "endChar": 55
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57953664_753b7400",
        "filename": "src/instrumentation/provider-win.cc",
        "patchSetId": 19
      },
      "lineNbr": 29,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-04T19:02:12Z",
      "side": 1,
      "message": "we should definitely clean this up before landing.",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 29,
        "endChar": 6
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fa497896_18b38024",
        "filename": "src/instrumentation/provider-win.cc",
        "patchSetId": 19
      },
      "lineNbr": 29,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-05T19:27:41Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "57953664_753b7400",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 29,
        "endChar": 6
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e149583_d23fcbb6",
        "filename": "src/instrumentation/provider.h",
        "patchSetId": 19
      },
      "lineNbr": 17,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-04T19:02:12Z",
      "side": 1,
      "message": "Let\u0027s rename this to Recorder as well. The namespace should be good enough for distinctions.",
      "range": {
        "startLine": 17,
        "startChar": 24,
        "endLine": 17,
        "endChar": 32
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b042c693_cffc6e95",
        "filename": "src/instrumentation/provider.h",
        "patchSetId": 19
      },
      "lineNbr": 17,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-05T18:21:46Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0e149583_d23fcbb6",
      "range": {
        "startLine": 17,
        "startChar": 24,
        "endLine": 17,
        "endChar": 32
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cca5951f_ae2998cd",
        "filename": "src/wasm/module-instantiate.cc",
        "patchSetId": 19
      },
      "lineNbr": 421,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2020-11-04T19:02:12Z",
      "side": 1,
      "message": "Could you make a separate CL with just the wasm changes?\n\nThen we can have the cleaner TimerScopes in the current CL.",
      "range": {
        "startLine": 420,
        "startChar": 2,
        "endLine": 421,
        "endChar": 16
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "618d0645_a67784f3",
        "filename": "src/wasm/module-instantiate.cc",
        "patchSetId": 19
      },
      "lineNbr": 421,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-05T14:46:40Z",
      "side": 1,
      "message": "wasm changes CL: https://chromium-review.googlesource.com/c/v8/v8/+/2518619",
      "parentUuid": "cca5951f_ae2998cd",
      "range": {
        "startLine": 420,
        "startChar": 2,
        "endLine": 421,
        "endChar": 16
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2eba49c3_d922a988",
        "filename": "src/wasm/module-instantiate.cc",
        "patchSetId": 19
      },
      "lineNbr": 421,
      "author": {
        "id": 1418022
      },
      "writtenOn": "2020-11-05T18:21:46Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "618d0645_a67784f3",
      "range": {
        "startLine": 420,
        "startChar": 2,
        "endLine": 421,
        "endChar": 16
      },
      "revId": "8483e648dc376dc36b9d12c124f8d67d69caf9ed",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}