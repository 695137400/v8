{
  "comments": [
    {
      "key": {
        "uuid": "b63a2f20_d1494198",
        "filename": "src/builtins/ic-callable.tq",
        "patchSetId": 5
      },
      "lineNbr": 130,
      "author": {
        "id": 1183889
      },
      "writtenOn": "2020-05-12T10:51:00Z",
      "side": 1,
      "message": "How about starting with\n  if (!TaggedEqual(first, second)) return false;\nto bailout quicker?\nOr even \n  return TaggedEqual(first, second) \u0026\u0026 TaggedEqual(first, GetArrayFunction());",
      "revId": "feafc480a118aed84a569946c958a51d020b7531",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1248affd_5f73b2e7",
        "filename": "src/builtins/ic-callable.tq",
        "patchSetId": 5
      },
      "lineNbr": 155,
      "author": {
        "id": 1183889
      },
      "writtenOn": "2020-05-12T10:51:00Z",
      "side": 1,
      "message": "Thinking out loud...\nThe Torque code you ported is correct, however, I\u0027m a bit worried that we keep it in a CSA-style with raw down casts and Is\u003c\u003e checks. \n\nWe could take a step back and consider introducing new union types that were not available in early CSA times and are not available in C++ code.\n\nIt looks, in the IC code there could be multiple kinds of feedback values:\na) non-Smi MaybeObject (or MaybeHeapObject): HeapObject|WeakHeapObject|ClearedRef (like in the ICs that you already ported)\nb) any MaybeObject: Object|WeakHeapObject|ClearedRef (like in load/store ICs)\nc) non-Object MaybeObject (or WeakMaybeObject): WeakHeapObject|ClearedRef\n\nIf we had such types then these checks could be implemented as Casts or you could use macros with parameterized labels:\n1) !IsWeakOrCleared() check could be turned to Cast\u003cObject\u003e(maybeObject or maybeHeapObject) otherwise IfWeakOrCleared(WeakMaybeObject)\n2) the existing MaybeObjectToStrong() could be renamed to WeakMaybeObjectToStrong()\n\nAnd finally, how about also avoiding UnsafeCasts?\n  try {\n    const allocationSite \u003d Cast\u003cAllocationSite\u003e(..) otherwise NotAllocationSite;\n    ...\n  \n  } label NotAllocationSite {}",
      "revId": "feafc480a118aed84a569946c958a51d020b7531",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}