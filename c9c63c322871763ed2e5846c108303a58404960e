{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "e921725e_eca1bae8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1419747
      },
      "writtenOn": "2024-10-07T19:50:37Z",
      "side": 1,
      "message": "Thanks for adding Camillo, Paolo.  Uploaded another patchset to rename a debug helper class to EtwDebug per your last comment.",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "108646a6_0d55da11",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1419747
      },
      "writtenOn": "2024-10-07T20:35:34Z",
      "side": 1,
      "message": "There are some follow-up work items that I\u0027d like to pursue.  We can land this change for an incremental improvement, or we can expand it to cover the additional work below (no harm should come to anyone\u0027s existing scenarios by landing the change as is).  Please let me know what you prefer.\n\n1. Capture state works for un-filtered (by URL) recording profiles, but the filtered code path still works as it did previously (only capturing state when the ETW tracing session is first started for this provider).  This happens because of an early return when is_etw_enabled is already true in the ETWEnableCallback function before we reach EnableLogWithFilterDataOnAllIsolates.  Probably some other minor code changes are needed beyond that so that the filtered path works the same way as the unfiltered.\n\n2. A unit test is still needed to cover the timeout and happy path for the ETW monitor.  An integration test would ideally also exist (or maybe it could also be another unit test if we can successfully mock all the dependencies?) for ensuring the expected source and method events are emitted from v8 when multiple ETW trace sessions are started and a capture state callback occurs.\n\n3. The current mechanism for scheduling emission of source and method events from the isolate thread only works if JavaScript is scheduled to run again at some point in the future.  We need to replace or augment the current mechanism to ensure we emit the necessary metadata when a capture state callback occurs and JS doesn\u0027t subsequently run.  I filed another feature request for this issue: https://issues.chromium.org/issues/371898615",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a8e544b2_d4653a5b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2024-10-07T23:48:15Z",
      "side": 1,
      "message": "Cool, I will have a detailed look tomorrow.\n\nPlease no cherry picks (you should merge into the main branch). BTW is this a Microsoft default instruction/setup? I\u0027ve seen now quite a few CLs from MS that are cherry-picks (which you should only ever use for security backmerges) and `git cl upload` will on a branch created from `main` should produce a default CL.",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e260f0d_6279bf32",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1419747
      },
      "writtenOn": "2024-10-08T18:23:46Z",
      "side": 1,
      "message": "I didn\u0027t intend to do a cherry pick (and my current branch is based off of main). Could you offer me some guidance on how to recover?\n\nThe short version is my branch is based off main, but this CL didn\u0027t start this way due to some initial build errors I encountered.\n\nWhen I initially pulled the latest changes for main (in my full Chromium enlistment), the branch wasn\u0027t stable (crashed on startup). I went looking for the latest known good Canary instead by checking out the tag that corresponded to the latest release at the time.  I don\u0027t believe there\u0027s any particular MSFT guidance to do that, it just seemed like the right thing to do.\n\nFrom there I developed my change and, once it was ready, I then uploaded my changes with a git cl upload, but to my surprise it included a v8-version.h file that wasn\u0027t part of my change. I figured that was because I was uploading a set of commits for a release branch that included the v8-version.h change plus my commits.\n\nI rebased my changes off of main and did another git cl upload and the unwanted file disappeared from the diff. I have continued from there.  My git log (for the v8 repo) that I\u0027m doing a git cl upload from now looks like this:\n\n\n```\ncommit 7bc0f9bbcde8762be8a5603e0072901b776d321f (HEAD -\u003e v8_etw_capture_state)\nAuthor: Bo Cupp \u003cpcupp@microsoft.com\u003e\nDate:   Mon Oct 7 12:44:41 2024 -0700\n\n    Rename v8::internal::Debug -\u003e v8::internal::EtwDebug\n\ncommit 2484ea7603a637ad0f1421892bab5fe963d17b4b\nAuthor: Bo Cupp \u003cpcupp@microsoft.com\u003e\nDate:   Mon Oct 7 10:49:38 2024 -0700\n\n    Use weak_ptr for monitor to avoid leaking in case of timeout\n\ncommit e2d18724de5bc29ae2885af3acc310101f2bd489\nAuthor: Bo Cupp \u003cpcupp@microsoft.com\u003e\nDate:   Thu Oct 3 23:35:27 2024 -0700\n\n    Add a etw-debug flag and _DEBUG guards for ETW log statements\n\ncommit 850a4729262308ba9f2e185d485c6a9e89776285\nAuthor: Bo Cupp \u003cpcupp@microsoft.com\u003e\nDate:   Fri Sep 27 16:20:16 2024 -0700\n\n    Implement capture state support for v8 provider (a bunch of debug statements still in there).\n\ncommit 6ea9baba45cd95ccd210fa90869c51c01467fac7 (origin/main, origin/HEAD, main)\nAuthor: Michael Achenbach \u003cmachenbach@chromium.org\u003e\nDate:   Tue Oct 1 18:40:19 2024 +0000\n\n    Revert \"Reland \"[GC] Simplify old generation limits initialization\"\"\n```\n\nWhat marks this CL as a cherry-pick and can I clear that from the CL in some way?",
      "parentUuid": "a8e544b2_d4653a5b",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9add34bd_0af1013e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1419747
      },
      "writtenOn": "2024-10-08T18:23:46Z",
      "side": 1,
      "message": "Sharing some history of the CL and questions related to Camillo\u0027s latest comment on cherry-picking.",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5448346c_4f492ffa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2024-10-08T18:43:06Z",
      "side": 1,
      "message": "Can you try `git cl --set-upstream-to\u003dorigin/main` ?",
      "parentUuid": "6e260f0d_6279bf32",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d6ef9692_6c6497d2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1419747
      },
      "writtenOn": "2024-10-08T20:47:55Z",
      "side": 1,
      "message": "Here\u0027s an update after running the `git cl upstream` command...",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "afa6237c_659a5b61",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1419747
      },
      "writtenOn": "2024-10-08T20:47:55Z",
      "side": 1,
      "message": "`gl cl --set-upstream-to\u003dorigin/main` prints the cl help message.  I don\u0027t think it is recognized as a valid command.\n\nI see `git cl upstream` is a command.  Running it shows:\n\n```\nC:\\v8\\v8\u003egit cl upstream\nrefs/remotes/origin/main\n```\n\n`git cl upstream --help` shows:\n`Usage: git cl upstream [options] [new upstream branch]`\n\nSo I did a `git cl upstream origin/main` but it looks like that just sets it to what it already was:\n\n```\nC:\\v8\\v8\u003egit cl upstream origin/main\nUpstream branch set to refs/remotes/origin/main\n```",
      "parentUuid": "5448346c_4f492ffa",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fa9295f9_ba1a2fe3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1132654
      },
      "writtenOn": "2024-10-08T20:51:10Z",
      "side": 1,
      "message": "us sorry, `git branch --set-upstream-to\u003d...`",
      "parentUuid": "afa6237c_659a5b61",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "295b1661_cd2efe12",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1419747
      },
      "writtenOn": "2024-10-08T21:41:40Z",
      "side": 1,
      "message": "I was simultaneously trying some things on the advice of another MSFT developer who works in Chromium and I\u0027m afraid I may have messed up the connection between my branch and this CL.\n\nTo recover I just made a new CL (which doesn\u0027t show up as a cherry-pick).  If it\u0027s OK with you let\u0027s abandon this one in favor of this new CL containing my last patchset: \n\nhttps://chromium-review.googlesource.com/c/v8/v8/+/5918068\n\nI will move over the unresolved comment I have open and provide a link back to this CL to capture a record of the previous comments / commits.",
      "parentUuid": "fa9295f9_ba1a2fe3",
      "revId": "c9c63c322871763ed2e5846c108303a58404960e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}