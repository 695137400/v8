{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "099191a5_3b555570",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1327869
      },
      "writtenOn": "2021-01-15T19:32:49Z",
      "side": 1,
      "message": "Georg PTAL\nMichael, Nico as FYI",
      "revId": "7b0ae587be0b048e2156363bfe35d3a0cc63115e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f4ed1470_cd13e115",
        "filename": "src/compiler/js-heap-broker.cc",
        "patchSetId": 7
      },
      "lineNbr": 985,
      "author": {
        "id": 1327869
      },
      "writtenOn": "2021-01-15T19:32:49Z",
      "side": 1,
      "message": "Willing to bikeshed this name and/or the \u0027PropertyDescriptor\u0027 one below",
      "range": {
        "startLine": 985,
        "startChar": 7,
        "endLine": 985,
        "endChar": 37
      },
      "revId": "7b0ae587be0b048e2156363bfe35d3a0cc63115e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "11a8997c_4dbaee2a",
        "filename": "src/compiler/js-heap-broker.cc",
        "patchSetId": 7
      },
      "lineNbr": 985,
      "author": {
        "id": 1327869
      },
      "writtenOn": "2021-01-20T19:20:47Z",
      "side": 1,
      "message": "Resolving since it got deleted.",
      "parentUuid": "f4ed1470_cd13e115",
      "range": {
        "startLine": 985,
        "startChar": 7,
        "endLine": 985,
        "endChar": 37
      },
      "revId": "7b0ae587be0b048e2156363bfe35d3a0cc63115e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9226e174_5639d7e3",
        "filename": "src/compiler/js-heap-broker.cc",
        "patchSetId": 7
      },
      "lineNbr": 989,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2021-01-18T06:26:55Z",
      "side": 1,
      "message": "I don\u0027t understand the separation.\n\nfield_index certainly belongs to PropertyDescriptor (actually we can remove it since it\u0027s already contained in PropertyDetails).\n\nfield_owner depends on the map but only in so far as that when determining a field\u0027s owner, we need to start with a map that has that field. So I think we can move that to PropertyDescriptor as well.\n\nis_unboxed_double_field comes from the underlying LayoutDescriptor. I\u0027m not familiar with that. We need to find out if two maps sharing the same DescriptorArray always have equal (same?) LayoutDescriptors, at least for the common properties. If yes, then this can also move to PropertyDescriptor.",
      "revId": "7b0ae587be0b048e2156363bfe35d3a0cc63115e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6864bb1c_e278ba99",
        "filename": "src/compiler/js-heap-broker.cc",
        "patchSetId": 7
      },
      "lineNbr": 989,
      "author": {
        "id": 1327869
      },
      "writtenOn": "2021-01-18T12:42:35Z",
      "side": 1,
      "message": "I separated it based on whether the map was used in serializing (i.e. MapData::SerializeOwnDescriptor) and when accessing those fields concurrently (e.g. MapRef::FindFieldOwner).\n\nMy intention is to move the methods that do not need to be attached to a Map into DescriptorArray. This way, we would be able to skip serialization for DescriptorArray without having to worry about doing the same with Maps.\n\nIn this vein, I don\u0027t see how {field_owner} can be moved to DescriptorArray since we would need maps in order to serialize/access it concurrently. For example, we would need to respect map\u0027s kind when doing the traversal.",
      "parentUuid": "9226e174_5639d7e3",
      "revId": "7b0ae587be0b048e2156363bfe35d3a0cc63115e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "551543f0_d8bf5c74",
        "filename": "src/compiler/js-heap-broker.cc",
        "patchSetId": 7
      },
      "lineNbr": 989,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2021-01-18T13:11:39Z",
      "side": 1,
      "message": "Regarding the last sentence: which kind and which traversal do you mean?\n\nStoring the owner information in the map data doesn\u0027t fit the object model because the owner information applies to all maps that share this descriptor array, so we would have to copy it to all of them.",
      "parentUuid": "6864bb1c_e278ba99",
      "revId": "7b0ae587be0b048e2156363bfe35d3a0cc63115e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7cba8d7_53957a77",
        "filename": "src/compiler/js-heap-broker.cc",
        "patchSetId": 7
      },
      "lineNbr": 989,
      "author": {
        "id": 1327869
      },
      "writtenOn": "2021-01-18T14:38:07Z",
      "side": 1,
      "message": "\u003e Regarding the last sentence: which kind and which traversal do you mean?\n\nWith kind I\u0027m referring to the ObjectDataKind e.g. kNeverSerialized.\nIn order to find the find owner we call Map::FindFieldOwner. That traversal through the maps can\u0027t happen concurrently (i.e the result has to be serialized) if the maps are kSerializedHeapObject, regardless of the data kind of the DescriptorArray. This would mean that both the DescriptorArray and the Map have to be the same ObjectDataKind.\n\n\u003e Storing the owner information in the map data doesn\u0027t fit the object model because the owner information applies to all maps that share this descriptor array, so we would have to copy it to all of them.\n\nThis makes sense. The reason I moved those three fields to MapData is that when we were calling those methods concurrently, we were querying the Map rather than the DescriptorArray.",
      "parentUuid": "551543f0_d8bf5c74",
      "revId": "7b0ae587be0b048e2156363bfe35d3a0cc63115e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "629478cd_7cc145c9",
        "filename": "src/compiler/js-heap-broker.cc",
        "patchSetId": 7
      },
      "lineNbr": 989,
      "author": {
        "id": 1327869
      },
      "writtenOn": "2021-01-20T19:20:47Z",
      "side": 1,
      "message": "Moved those fields to DescriptorArray.",
      "parentUuid": "e7cba8d7_53957a77",
      "revId": "7b0ae587be0b048e2156363bfe35d3a0cc63115e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}