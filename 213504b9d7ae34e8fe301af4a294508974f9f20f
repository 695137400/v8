{
  "comments": [
    {
      "key": {
        "uuid": "1b3d22dc_29bf81b2",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1323125
      },
      "writtenOn": "2019-09-17T14:27:22Z",
      "side": 1,
      "message": "Hello,\n\nSince \"code\" is now of type \"kCallCodeObject\", passing it to \"CallCFunction\" is causing\na crash on AIX. AIX expects a pointer to a function descriptor on any code_entry (of type kCallAddress) passed to \"CallCFunction\".\nIs there a convenient way to call this entry with kCallCodeObject instead of the default kCallAddress? Maybe use CallStub instead of CallCFunction?",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7613326a_ac6680e3",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1162439
      },
      "writtenOn": "2019-09-18T05:15:28Z",
      "side": 1,
      "message": "Not sure I understand fully:\n\n- Prior to this CL, the target was always a Code object containing jitted irregexp code.\n- With this CL, the target can also be a trampoline builtin (with an off-heap instruction stream).\n\nThe former suggests that calling the Code object is not problematic, rather the off-heap builtin. Does that make sense?",
      "parentUuid": "1b3d22dc_29bf81b2",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0d100c1_963135fa",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1155482
      },
      "writtenOn": "2019-09-18T12:58:28Z",
      "side": 1,
      "message": "That makes sense. On AIX, irregexp code has a function descriptor as explain here:\nhttps://chromium-review.googlesource.com/c/v8/v8/+/1487341\nBut all other jitted code doesn\u0027t have function descriptor anymore as explain here:\nhttps://chromium-review.googlesource.com/c/v8/v8/+/1448711\nAs of result, use CallCFunction to call both of irregexp and builtin won\u0027t work on AIX.\nCan we separate them by using a different call here?\n\nThanks.",
      "parentUuid": "7613326a_ac6680e3",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3a5f385_79606801",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1162439
      },
      "writtenOn": "2019-09-19T07:08:16Z",
      "side": 1,
      "message": "It sounds like a solution is to add \u0027__ function_descriptor()\u0027 to the RegExpInterpreterTrampoline on ppc? It is only ever called from this callsite.",
      "parentUuid": "d0d100c1_963135fa",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6611fd3e_23c42d59",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1155482
      },
      "writtenOn": "2019-09-19T11:50:08Z",
      "side": 1,
      "message": "Sound like a solution. But is RegExpInterpreterTrampoline going to be part of the embedded builtins? (currently or in the future). If that\u0027s the case, function descriptor will cause reloc issue.",
      "parentUuid": "d3a5f385_79606801",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0f96c69c_a96ee06e",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1323125
      },
      "writtenOn": "2019-09-19T11:56:03Z",
      "side": 1,
      "message": "I tried modifying the \"Generate_RegExpInterpreterTrampoline\" function and added \"masm-\u003efunction_descriptor();\" right before the jump instruction but I get the following error when compiling: RegExpInterpreterTrampoline is not isolate-independent.",
      "parentUuid": "6611fd3e_23c42d59",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c3dfde9_400b6174",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1162439
      },
      "writtenOn": "2019-09-19T13:13:46Z",
      "side": 1,
      "message": "Yes, it\u0027s a builtin (and thus embedded). It\u0027d be great to keep this single call site, that was the entire point of the refactoring done in this CL. \n\nIt sounds like we need new functionality to support the complexities around function descriptors on ppc, sadly. A special case of CallCFunction that doesn\u0027t expect a function descriptor.",
      "parentUuid": "0f96c69c_a96ee06e",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2640f22_28091a08",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1155482
      },
      "writtenOn": "2019-09-19T14:42:30Z",
      "side": 1,
      "message": "I think the problem here is that regexp has function descriptor but the trampoline doesn\u0027t. So if they share the same entry (CallCFunction or CallCFunction without fd), one of them would not work correctly. We need a way to tell if the code being called is regexp or trampoline.",
      "parentUuid": "4c3dfde9_400b6174",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17c0e4f8_bf05cc3d",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1162439
      },
      "writtenOn": "2019-09-19T15:12:43Z",
      "side": 1,
      "message": "There is currently in-progress work by anapesko@ that will add a builtin trampoline for the jitting case as well. That would solve this issue (although we still need a way to call a builtin with C linkage *without* a function descriptor).",
      "parentUuid": "c2640f22_28091a08",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fce23819_e6521711",
        "filename": "src/builtins/builtins-regexp-gen.cc",
        "patchSetId": 8
      },
      "lineNbr": 617,
      "author": {
        "id": 1323125
      },
      "writtenOn": "2019-09-20T12:37:27Z",
      "side": 1,
      "message": "I\u0027m just curious on the need for a trampoline in this scenario. Is it not possible to call the Interpreter or the jitted irregexp code directly? Reason for asking is, we are calling a trampoline with a \"CallCFunction\" but a trampoline isn\u0027t a CFunction.\nOn the other hand, the trampoline should do a \"CallCFunction\" instead of a \"Jump\" as it\u0027s calling a real CFunction (Im assuming the Interpreter and the jitted irregexp code are both CFunctions).",
      "parentUuid": "17c0e4f8_bf05cc3d",
      "revId": "213504b9d7ae34e8fe301af4a294508974f9f20f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}