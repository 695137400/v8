{
  "comments": [
    {
      "key": {
        "uuid": "f4d567c2_b9ea0be2",
        "filename": "src/profiler/heap-snapshot-generator.cc",
        "patchSetId": 8
      },
      "lineNbr": 251,
      "author": {
        "id": 1002405
      },
      "writtenOn": "2018-09-26T04:01:36Z",
      "side": 1,
      "message": "Is it possible to fill this cache in explicitly after entries_ are filled?\n\nOtherwise it may hide a bug when GetEntryById is called to early.",
      "range": {
        "startLine": 246,
        "startChar": 1,
        "endLine": 251,
        "endChar": 3
      },
      "revId": "6f66ec97405b7a474d1528a03198d9df34239c62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3618e012_11fe8331",
        "filename": "src/profiler/heap-snapshot-generator.cc",
        "patchSetId": 8
      },
      "lineNbr": 251,
      "author": {
        "id": 1115861
      },
      "writtenOn": "2018-09-26T15:55:33Z",
      "side": 1,
      "message": "We\u0027d like to have it built lazily just in case the client never uses it. There\u0027s a DCHECK at 226. I\u0027ll put a CHECK here as well.",
      "parentUuid": "f4d567c2_b9ea0be2",
      "range": {
        "startLine": 246,
        "startChar": 1,
        "endLine": 251,
        "endChar": 3
      },
      "revId": "6f66ec97405b7a474d1528a03198d9df34239c62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07ff6a09_2184819e",
        "filename": "src/profiler/heap-snapshot-generator.h",
        "patchSetId": 8
      },
      "lineNbr": 216,
      "author": {
        "id": 1002405
      },
      "writtenOn": "2018-09-26T04:01:36Z",
      "side": 1,
      "message": "What is the motivation for making it vector?\n\nI think edges_ and children_ are deques to work around 2GB limit that malloc imposes on vectors.\n\nSo this change will decrease the max heap size we can handle.",
      "range": {
        "startLine": 216,
        "startChar": 7,
        "endLine": 216,
        "endChar": 13
      },
      "revId": "6f66ec97405b7a474d1528a03198d9df34239c62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "910b1529_50d80cf0",
        "filename": "src/profiler/heap-snapshot-generator.h",
        "patchSetId": 8
      },
      "lineNbr": 216,
      "author": {
        "id": 1115861
      },
      "writtenOn": "2018-09-26T15:55:33Z",
      "side": 1,
      "message": "We know the size of children by the time we allocate it. So it\u0027s nice to have them in a single chunk. Never heard about the limit. Where\u0027s it specified?",
      "parentUuid": "07ff6a09_2184819e",
      "range": {
        "startLine": 216,
        "startChar": 7,
        "endLine": 216,
        "endChar": 13
      },
      "revId": "6f66ec97405b7a474d1528a03198d9df34239c62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "621b1586_1e86b3e7",
        "filename": "src/profiler/heap-snapshot-generator.h",
        "patchSetId": 8
      },
      "lineNbr": 216,
      "author": {
        "id": 1115861
      },
      "writtenOn": "2018-09-26T17:41:32Z",
      "side": 1,
      "message": "Just checked both vector and deque report max_size() of 18446744073709551615 bytes on x64, and 4294967295 bytes on x32. I\u0027ll go ahead and land it as is. If you still have concerns about 2GB limit we can discuss it and revert the children storage back to deque.",
      "parentUuid": "910b1529_50d80cf0",
      "range": {
        "startLine": 216,
        "startChar": 7,
        "endLine": 216,
        "endChar": 13
      },
      "revId": "6f66ec97405b7a474d1528a03198d9df34239c62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0371a5a1_1c048903",
        "filename": "src/profiler/heap-snapshot-generator.h",
        "patchSetId": 8
      },
      "lineNbr": 216,
      "author": {
        "id": 1002405
      },
      "writtenOn": "2018-10-01T10:50:55Z",
      "side": 1,
      "message": "Here is the context for children deque: https://codereview.chromium.org/2595003002",
      "parentUuid": "621b1586_1e86b3e7",
      "range": {
        "startLine": 216,
        "startChar": 7,
        "endLine": 216,
        "endChar": 13
      },
      "revId": "6f66ec97405b7a474d1528a03198d9df34239c62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "83a6847a_62cc1ec2",
        "filename": "src/profiler/heap-snapshot-generator.h",
        "patchSetId": 8
      },
      "lineNbr": 216,
      "author": {
        "id": 1115861
      },
      "writtenOn": "2018-10-01T18:02:20Z",
      "side": 1,
      "message": "Thanks for the link. I read that.\n\nThe 2GB limit on a single allocation (which std::vector makes) is imposed by the sandbox. I guess that\u0027s to prevent improper indexing with 32-bits signed int type.\n\nHowever there\u0027s a global limit to the process data segment of 4GB on x64. https://cs.chromium.org/chromium/src/sandbox/constants.h?type\u003dcs\u0026g\u003d0\u0026l\u003d18\n\nProvided that we have already successfully allocated edges having 24 bytes per item (they fitted into 4GB), then total size of 8-byte sized children is less than 2GB, so we should be safe here.",
      "parentUuid": "0371a5a1_1c048903",
      "range": {
        "startLine": 216,
        "startChar": 7,
        "endLine": 216,
        "endChar": 13
      },
      "revId": "6f66ec97405b7a474d1528a03198d9df34239c62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}