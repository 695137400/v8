{
  "comments": [
    {
      "key": {
        "uuid": "0a29b74f_4305702c",
        "filename": "include/v8-platform.h",
        "patchSetId": 2
      },
      "lineNbr": 307,
      "author": {
        "id": 1002405
      },
      "writtenOn": "2018-05-07T06:50:01Z",
      "side": 0,
      "message": "V8_DEPRECATE_SOON is not sufficient for removing.\n\nIt should be V8_DEPRECATED for one release before we can remove it:\nhttps://github.com/v8/v8/wiki/How-to-change-V8-public-API",
      "range": {
        "startLine": 307,
        "startChar": 2,
        "endLine": 307,
        "endChar": 19
      },
      "revId": "7d57be43a1553e44daf5f01e8981f0824cdc3ca2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "22395f52_b8026740",
        "filename": "include/v8-platform.h",
        "patchSetId": 2
      },
      "lineNbr": 307,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-05-07T16:12:42Z",
      "side": 0,
      "message": "The reason I used V8_DEPRECATE_SOON is that v8 wouldn\u0027t compile when the new APIs redirected to the old APIs by default if those were marked V8_DEPRECATED.\n\ni.e.\n\n  virtual int NumberOfWorkerThreads() {\n    return static_cast\u003cint\u003e(NumberOfAvailableBackgroundThreads());\n  }\n\nwould complain if NumberOfAvailableBackgroundThreads() is marked V8_DEPRECATED.\n\nHence, the minimum this CL can do is make the new ones pure-virtual and mark the old ones V8_DEPRECATED for realz.\n\nBut then embedders will fail to compile if they have yet to switch anyways (because of the pure-virtual calls).\nAnd I can\u0027t imagine it makes any sense for any embedder to fix their compilation per new pure-virtuals but not stop overriding old APIs.\n\nAs such I don\u0027t think going to V8_DEPRECATED has any value here.",
      "parentUuid": "0a29b74f_4305702c",
      "range": {
        "startLine": 307,
        "startChar": 2,
        "endLine": 307,
        "endChar": 19
      },
      "revId": "7d57be43a1553e44daf5f01e8981f0824cdc3ca2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e1705223_dfb2f797",
        "filename": "include/v8-platform.h",
        "patchSetId": 2
      },
      "lineNbr": 307,
      "author": {
        "id": 1002405
      },
      "writtenOn": "2018-05-07T16:40:16Z",
      "side": 0,
      "message": "Can we turn that around? \n\nV8_DEPRECATED(\"\", virtual size_t NumberOfAvailableBackgroundThreads()) {\n   return static_cast\u003csize_t\u003e(NumberOfWorkerThreads());\n});\n\n\u003e As such I don\u0027t think going to V8_DEPRECATED has any value here.\n\nThe embedders should get a compile warning when running with v8_deprecation_warnings \u003d true, so that they can fix their before the next V8 release.",
      "parentUuid": "22395f52_b8026740",
      "range": {
        "startLine": 307,
        "startChar": 2,
        "endLine": 307,
        "endChar": 19
      },
      "revId": "7d57be43a1553e44daf5f01e8981f0824cdc3ca2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44c3708d_101767f4",
        "filename": "include/v8-platform.h",
        "patchSetId": 2
      },
      "lineNbr": 307,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-05-07T17:11:11Z",
      "side": 0,
      "message": "But then we still need to make NumberOfWorkerThreads() pure-virtual and they\u0027ll get a compile error regardless.\n\n(well NumberOfWorkerThreads() is a bad example because there\u0027s an easy default but there isn\u0027t for other APIs affected here, basically the problem is they already provide an impl and we want them to point it at the new API, not silently drop their impl)\n\nFWIW, making long-standing \"new\" methods like GetForegroundTaskRunner() pure-virtual has the same problem. It will not compile the minute they sync even though no macro warned them that they had to implement it.",
      "parentUuid": "e1705223_dfb2f797",
      "range": {
        "startLine": 307,
        "startChar": 2,
        "endLine": 307,
        "endChar": 19
      },
      "revId": "7d57be43a1553e44daf5f01e8981f0824cdc3ca2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "75c67378_c3ac3de0",
        "filename": "include/v8-platform.h",
        "patchSetId": 2
      },
      "lineNbr": 307,
      "author": {
        "id": 1002405
      },
      "writtenOn": "2018-05-07T21:12:58Z",
      "side": 0,
      "message": "I see. Looks like there is no way to deprecate the function properly.\n\nDoes it make sense to keep the default implementations for GetForegroundTaskRunner() and idle task related functions? I guess most of the embedders will provide the same trivial implementation for these functions. If we don\u0027t get any value from making them pure, then we should reduce the breakage.",
      "parentUuid": "44c3708d_101767f4",
      "range": {
        "startLine": 307,
        "startChar": 2,
        "endLine": 307,
        "endChar": 19
      },
      "revId": "7d57be43a1553e44daf5f01e8981f0824cdc3ca2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a439419_c2f72a02",
        "filename": "include/v8-platform.h",
        "patchSetId": 2
      },
      "lineNbr": 307,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-05-08T00:49:40Z",
      "side": 0,
      "message": "I don\u0027t feel strongly here, I\u0027ll let you decide among platform owners. My 2 cents is that if you have a sane default and don\u0027t rely on an override, maybe it\u0027s fine. But right now the default is null and maybe that\u0027s a bit weird (though I guess we have to support that and if we will we might as well have it by default so it\u0027s tested..).",
      "parentUuid": "75c67378_c3ac3de0",
      "range": {
        "startLine": 307,
        "startChar": 2,
        "endLine": 307,
        "endChar": 19
      },
      "revId": "7d57be43a1553e44daf5f01e8981f0824cdc3ca2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "80e178dd_ea20820d",
        "filename": "include/v8-platform.h",
        "patchSetId": 2
      },
      "lineNbr": 307,
      "author": {
        "id": 1002405
      },
      "writtenOn": "2018-05-08T10:34:26Z",
      "side": 0,
      "message": "I would vote for keeping the default implementations then.",
      "parentUuid": "8a439419_c2f72a02",
      "range": {
        "startLine": 307,
        "startChar": 2,
        "endLine": 307,
        "endChar": 19
      },
      "revId": "7d57be43a1553e44daf5f01e8981f0824cdc3ca2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "83d1717c_1454f40e",
        "filename": "include/v8-platform.h",
        "patchSetId": 2
      },
      "lineNbr": 307,
      "author": {
        "id": 1001534
      },
      "writtenOn": "2018-05-08T19:16:23Z",
      "side": 0,
      "message": "Ok, I brought back default impls for idle tasks. I think we should keep GetForegroundTaskRunner() pure virtual though because the code assumes it exists (uses it without checking for null). CallIdleOnForegroundThread() is gated on IdleTasksEnabled() so it\u0027s different (and having it default to disabled is fine).",
      "parentUuid": "80e178dd_ea20820d",
      "range": {
        "startLine": 307,
        "startChar": 2,
        "endLine": 307,
        "endChar": 19
      },
      "revId": "7d57be43a1553e44daf5f01e8981f0824cdc3ca2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}