{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9a5d6eb1_8b11790f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T12:26:55Z",
      "side": 1,
      "message": "PTAL! :)",
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ea349511_85f77acb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "LGTM with comments. I have to admit that the `FrameState` building business is not trivial, so it\u0027s hard for me to review that properly and therefore I might miss stuff as I\u0027m not very familiar with how these things work in JS. ðŸ˜Š",
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e26b641_937c0e8b",
        "filename": "src/compiler/turboshaft/maglev-early-lowering-reducer-inl.h",
        "patchSetId": 2
      },
      "lineNbr": 109,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "This doesn\u0027t sound very stable (and you didn\u0027t specify a version), 13.2.2 seems to be `Identifier Reference` in version 13.0 and I\u0027m not sure that\u0027s what you are referring to. ðŸ˜Š",
      "range": {
        "startLine": 108,
        "startChar": 64,
        "endLine": 109,
        "endChar": 17
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7b43657f_c4881b65",
        "filename": "src/compiler/turboshaft/maglev-early-lowering-reducer-inl.h",
        "patchSetId": 2
      },
      "lineNbr": 109,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T16:02:24Z",
      "side": 1,
      "message": "That\u0027s a good point... I\u0027ve just copy-pasted a Maglev comment, which itself was copy-pasted from some builtins-xxx.cc file. \n\nAnd I\u0027ve tracked back where this comment came from, and it was first introduced in V8 in 2009 (https://codereview.chromium.org/148293020/patch/390006/10070) (well, actually, it seems that it used to be on a separate branch and was moved to ToT in 2009; who knows when it was actually written), and I think that it refers to version 5.1 (https://262.ecma-international.org/5.1/#sec-13.2.2). In the latest ECMA spec, this corresponds to https://262.ecma-international.org/14.0/#sec-ecmascript-function-objects-construct-argumentslist-newtarget, but I\u0027m not sure how this relates to this comment.\n\nI\u0027ve thus just updated the comment to say \"version 5.1\".",
      "parentUuid": "8e26b641_937c0e8b",
      "range": {
        "startLine": 108,
        "startChar": 64,
        "endLine": 109,
        "endChar": 17
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2caa7342_ef0a53ef",
        "filename": "src/compiler/turboshaft/maglev-early-lowering-reducer-inl.h",
        "patchSetId": 2
      },
      "lineNbr": 147,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "I assume you wanted to extract this into its own function for reuse but I don\u0027t see a second user? Did I miss anything?\n(Not wrong to factor it out, I\u0027m just confused.)",
      "range": {
        "startLine": 147,
        "startChar": 12,
        "endLine": 147,
        "endChar": 36
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "07c0e194_55db3724",
        "filename": "src/compiler/turboshaft/maglev-early-lowering-reducer-inl.h",
        "patchSetId": 2
      },
      "lineNbr": 147,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T16:02:24Z",
      "side": 1,
      "message": "Ah indeed good point. I think that what happened is that I looked at how JumpIfJSAnyIsNotPrimitive is implemented in Maglev, I saw that it uses CmpInstanceTypeRange, I then extracted out CompareInstanceTypeRange in its own function, and I later realized that Maglev actually only uses CmpInstanceTypeRange in JumpIfJSAnyIsNotPrimitive in DEBUG mode, so I didn\u0027t need it in Turboshaft.\n\nI think that we can still keep it in its own function as you say.",
      "parentUuid": "2caa7342_ef0a53ef",
      "range": {
        "startLine": 147,
        "startChar": 12,
        "endLine": 147,
        "endChar": 36
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab040d71_3680ac18",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1780,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "This seems to be handled in line 1770? And if not, then we are missing some body or an `UNIMPLEMENTED();` here. ðŸ˜Š",
      "range": {
        "startLine": 1778,
        "startChar": 4,
        "endLine": 1780,
        "endChar": 5
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fad0ac5f_f5020b86",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1780,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T16:02:24Z",
      "side": 1,
      "message": "Good catch, that\u0027s leftover from a previous version. Removed :)",
      "parentUuid": "ab040d71_3680ac18",
      "range": {
        "startLine": 1778,
        "startChar": 4,
        "endLine": 1780,
        "endChar": 5
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2cd3905d_b9ea026c",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1811,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "Yes, this would be great!\nSame issue: https://source.chromium.org/chromium/chromium/src/+/main:v8/src/wasm/turboshaft-graph-interface.cc;l\u003d5084?q\u003dturboshaft-graph-int\u0026ss\u003dchromium\nI guess, I should use a smi as well instead of the dummy value, that would be a bit cleaner.",
      "range": {
        "startLine": 1809,
        "startChar": 15,
        "endLine": 1811,
        "endChar": 30
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0e8a1c13_78e7a846",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1811,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T16:02:24Z",
      "side": 1,
      "message": "Ah good to know that you have a similar issue in Wasm, thanks for pointing it out! :)",
      "parentUuid": "2cd3905d_b9ea026c",
      "range": {
        "startLine": 1809,
        "startChar": 15,
        "endLine": 1811,
        "endChar": 30
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "03fe541b_19c149d0",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1811,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T17:45:40Z",
      "side": 1,
      "message": "Yeah, it\u0027s just worse for me as I also don\u0027t have a context. ðŸ˜Š",
      "parentUuid": "0e8a1c13_78e7a846",
      "range": {
        "startLine": 1809,
        "startChar": 15,
        "endLine": 1811,
        "endChar": 30
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee06f2d5_54288268",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1834,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "So the parent frame always has `Ignore`? Why?",
      "range": {
        "startLine": 1834,
        "startChar": 27,
        "endLine": 1834,
        "endChar": 60
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "432036a3_20d63f87",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1834,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T16:02:24Z",
      "side": 1,
      "message": "In Maglev, the \"PokeAt\" is not an attribute of the DeoptFrame, but rather of the LazyDeoptInfo. As such, it only makes sense for the topmost frame (since it\u0027s directly attached to a LazyDeoptInfo), and is Ignore for every other frame.\n\nI\u0027ve refactored the code a little bit so that building parent frame states goes through a BuildParentFrameState function that doesn\u0027t take an OutputFrameStateCombine as input, and it contains a comment explaining why.\n\n(and as far as Turbofan is concerned, I don\u0027t know if PokeAt can be used for anything other than topmost frames, but I assume that not)",
      "parentUuid": "ee06f2d5_54288268",
      "range": {
        "startLine": 1834,
        "startChar": 27,
        "endLine": 1834,
        "endChar": 60
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82e36594_615e8396",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1919,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "What\u0027s the parameter? The stub to be invoked? Maybe add a comment?",
      "range": {
        "startLine": 1919,
        "startChar": 56,
        "endLine": 1919,
        "endChar": 57
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "68104de4_34f18c40",
        "filename": "src/compiler/turboshaft/maglev-graph-building-phase.cc",
        "patchSetId": 2
      },
      "lineNbr": 1919,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T16:02:24Z",
      "side": 1,
      "message": "That\u0027s a very good question, and the sad answer is that I just copy-pasted this from js-call-reducer ðŸ˜„\n\nAfter digging a little bit, it\u0027s the parameter_count and the local_count. I made that more explicit.",
      "parentUuid": "82e36594_615e8396",
      "range": {
        "startLine": 1919,
        "startChar": 56,
        "endLine": 1919,
        "endChar": 57
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d539d03_c934bea2",
        "filename": "test/mjsunit/turboshaft/turboshaft-maglev-frontend.js",
        "patchSetId": 2
      },
      "lineNbr": 1088,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "This is just a literal I guess. maybe change it to `{ \"a\" : 42, c }`, then you\u0027d have both literals as well as \"dynamic\" values.",
      "range": {
        "startLine": 1088,
        "startChar": 12,
        "endLine": 1088,
        "endChar": 24
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3facc8c3_d3ea2141",
        "filename": "test/mjsunit/turboshaft/turboshaft-maglev-frontend.js",
        "patchSetId": 2
      },
      "lineNbr": 1088,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T16:02:24Z",
      "side": 1,
      "message": "Good idea. Also, with `c` being a heap object, this leads to Maglev emitting a CheckHeapObject, which wasn\u0027t supported so far, so that\u0027s nice :)",
      "parentUuid": "4d539d03_c934bea2",
      "range": {
        "startLine": 1088,
        "startChar": 12,
        "endLine": 1088,
        "endChar": 24
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "060b4512_4b93278e",
        "filename": "test/mjsunit/turboshaft/turboshaft-maglev-frontend.js",
        "patchSetId": 2
      },
      "lineNbr": 1134,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T14:53:51Z",
      "side": 1,
      "message": "Is there some reason to not use booleans for conditions in JS? ðŸ˜„",
      "range": {
        "startLine": 1134,
        "startChar": 15,
        "endLine": 1134,
        "endChar": 16
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9555e573_e4031de4",
        "filename": "test/mjsunit/turboshaft/turboshaft-maglev-frontend.js",
        "patchSetId": 2
      },
      "lineNbr": 1134,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2024-04-22T16:02:24Z",
      "side": 1,
      "message": "Whups, I guess I\u0027m just too used to working on Turboshaft\u0027s backend, I forgot that we were actually coming from JS where booleans are a thing.",
      "parentUuid": "060b4512_4b93278e",
      "range": {
        "startLine": 1134,
        "startChar": 15,
        "endLine": 1134,
        "endChar": 16
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6e999602_aae4a146",
        "filename": "test/mjsunit/turboshaft/turboshaft-maglev-frontend.js",
        "patchSetId": 2
      },
      "lineNbr": 1134,
      "author": {
        "id": 1549182
      },
      "writtenOn": "2024-04-22T17:45:40Z",
      "side": 1,
      "message": "ðŸ˜„",
      "parentUuid": "9555e573_e4031de4",
      "range": {
        "startLine": 1134,
        "startChar": 15,
        "endLine": 1134,
        "endChar": 16
      },
      "revId": "79010a1c91dcc7a45e16c8e48feebfc0a6e14c87",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}