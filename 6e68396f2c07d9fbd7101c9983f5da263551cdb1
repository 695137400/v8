{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9190195e_c78de9a7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2022-11-02T17:20:21Z",
      "side": 1,
      "message": "Some context around those functions, which could be useful to determine if it\u0027s worth optimizing them: in JetStream2 (arguably not the best benchmark, and it\u0027s possible that this doesn\u0027t reflect real-world benchmarks, but still better than nothing), here is the number of times that those functions are called:\n  - DoubleToInt32: 10,200,000 times\n  - DoubleToInteger: 11,000,000 times\n  - IsInt32Double: 1,400,000 times\n  - the other functions are not called.\nI would say that this sounds like large-ish numbers, so maybe it\u0027s worth optimizing those functions.\n\nHowever, in my benchmarks (on a Comet Lake), your SSE versions of DoubleToInteger and IsInt32Double are 2.5 times slower than the scalar versions (I didn\u0027t benchmark DoubleToInt32, but I expect similar results). Could you please share the performance numbers you measured on your side, how you measured them, and on which architecture?",
      "revId": "6e68396f2c07d9fbd7101c9983f5da263551cdb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "50f65395_84cfeb34",
        "filename": "src/numbers/conversions-inl.h",
        "patchSetId": 2
      },
      "lineNbr": 35,
      "author": {
        "id": 1535927
      },
      "writtenOn": "2022-11-02T16:44:56Z",
      "side": 1,
      "message": "It looks like your implementation is truncating its input, whereas the older implementations rounds it. I haven\u0027t looked at the use-cases in details, but I would expect that this could be an issue. It might be worth adding a DCHECK to make sure that this implementation returns the same result as the older one.\n\nAlso, on which architecture have you benchmarked your code? On my Comet Lake, the old scalar implementation is 1.2x faster that your new implementation.\n\nRegardless, I share Clemens\u0027 concern that the added complexity of this SSE version might not be worth the potential performance improvements, but I\u0027ll let Tobias be the judge of that :)",
      "range": {
        "startLine": 35,
        "startChar": 20,
        "endLine": 35,
        "endChar": 38
      },
      "revId": "6e68396f2c07d9fbd7101c9983f5da263551cdb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}